FROM metasploitframework/metasploit-framework:latest

USER root

# Installer Python3, pip, postgresql client
RUN apk update && apk add --no-cache \
    python3 \
    py3-pip \
    postgresql-client

# Installer xmltodict avec pip
RUN pip install xmltodict

# Définir le répertoire de travail
WORKDIR /app

# Copier les fichiers nécessaires dans l’image
COPY msf_auto_scan.py /app/msf_auto_scan.py
COPY metasploit/scan_template.rc /app/metasploit/scan_template.rc

# Démarrer msfconsole avec le script Python en CMD
ENTRYPOINT ["msfconsole"]
CMD ["-r", "/app/metasploit/scan_template.rc"]
