FROM metasploitframework/metasploit-framework:latest

USER root

# Installer Python3 et pip (selon la base, ici on tente apk, sinon apt)
RUN apk add --no-cache python3 py3-pip || \
    (apt-get update && apt-get install -y python3 python3-pip && apt-get clean)
RUN apt-get update && apt-get install -y postgresql

WORKDIR /app

COPY msf_auto_scan.py /app/msf_auto_scan.py
COPY metasploit/scan_template.rc /app/metasploit/scan_template.rc

ENTRYPOINT ["msfconsole"]

CMD ["python3", "/app/msf_auto_scan.py"]
