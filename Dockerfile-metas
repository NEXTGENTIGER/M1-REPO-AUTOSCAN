FROM metasploitframework/metasploit-framework:latest

USER root

# Installer python, pip et postgresql client
RUN apk update && apk add --no-cache \
    python3 \
    py3-pip \
    postgresql-client \
    bash

# Installer la dépendance Python
RUN pip install xmltodict

# Définir le dossier de travail
WORKDIR /app

# Copier les fichiers
COPY msf_auto_scan.py /app/msf_auto_scan.py
COPY metasploit/scan_template.rc /app/metasploit/scan_template.rc

# Utiliser bash comme shell et lancer msfconsole avec le fichier RC
CMD ["/bin/bash", "-c", "msfconsole -r /app/metasploit/scan_template.rc"]
